var SearchHandler=function(e){this.instrumentSearchConfig=window[e]};SearchHandler.prototype=(init=function(){var e=this;this.results="#"+this.instrumentSearchConfig.resultsId,this.input=$("#"+this.instrumentSearchConfig.searchInstrumentsId),e.$wrapper=$(e.input).closest(".table-input-search"),e.$results=$(e.results),e.$searchDropDown=$("#search-dropdown"),this.input.on("keydown",function(t){if(38===t.which||40===t.which){var a=$(e.results+" .auto-complete.selected"),r=a.prev(),s=a.next();switch(r.is("li")||(r=$(e.results+" .auto-complete").first()),s.is("li")||(s=$(e.results+" .auto-complete:last")),a.toggleClass("selected"),t.which){case 38:e.input.prop("value",r.data("text")),r.toggleClass("selected"),$(e.results+" ul").scrollTo(r);break;case 40:e.input.prop("value",s.data("text")),s.toggleClass("selected"),$(e.results+" ul").scrollTo(s)}e.input.addClass("auto-complete-chage"),t.preventDefault()}}),this.input.on("keyup",function(t){if(13===t.keyCode){var a=$(e.results+" .auto-complete.selected").first();null!=a&&(e.input.addClass("auto-complete-chage"),a.click())}}),e.cache={},e.lastValue="",e.searchCount=0,e.lastSearchTermWithResult="",Rx.Observable.fromEventPattern(function(t){e.input.on("change",t),e.input.on("keyup",t)}).pluck("target","value").filter(function(t){return e.input.hasClass("auto-complete-chage")?(e.lastValue=t,e.input.removeClass("auto-complete-chage"),!1):t.length>=2&&!/^\s*$/.test(t)&&e.lastValue!==t}).switchMap(function(t){e.lastValue=t;var a=t.toLowerCase();return e.$searchDropDown.addClass("animate"),e.cache.hasOwnProperty(e.termToSearch)?Rx.Observable.from([e.cache[e.termToSearch]]):$.ajax({url:e.instrumentSearchConfig.searchHandlerUrl,dataType:"json",type:"POST",data:{term:a,token:e.instrumentSearchConfig.token,searchCount:a.length>=e.instrumentSearchConfig.minLengthOfSearchTerm?++e.searchCount:e.searchCount}}).promise()}).subscribe(function(t){e.cache[t.Data.term]=t,t.Data.term===e.input.val().toLowerCase()&&(null===t.Data.results||t.Data.results.length<1?(e.$results.empty(),e.$wrapper.removeClass("matching-results"),e.$wrapper.removeClass("error-results")):(e.lastSearchTermWithResult=t.Data.term,e.$results.empty().append($("<ul>").append($.map(t.Data.results,function(e){var a=(e.IsDisplaySymbol&&null!==e.Symbol?e.Symbol+" ":"")+e.Name;return $('<li class="auto-complete" data-text="'+a+'" data-symbol="'+e.Symbol+'" >').append($('<a href="javascript:void(0);" >').html(a.replace(RegExp(t.Data.term,"ig"),function(e){return"<strong class='highlight-search'>"+e+"</strong>"})))}))),e.$wrapper.addClass("matching-results")),$(e.results+" .auto-complete").first().addClass("selected"),e.$searchDropDown.removeClass("animate"))},function(t){e.$searchDropDown.removeClass("animate"),e.$wrapper.addClass("error-results"),e.$results.empty().append($('<span class="error-search">').text(e.instrumentSearchConfig.errorText))}),Rx.Observable.fromEvent(e.input,"keyup").pluck("target","value").filter(function(e){return e.length<2}).subscribe(function(){e.$results.empty(),e.lastValue="",e.$searchDropDown.addClass("animate"),e.$wrapper.removeClass("matching-results"),e.$wrapper.removeClass("error-results")}),e.$results.on("mousedown","li.auto-complete",function(){var t=e.instrumentSearchConfig.templateUrl;window.location.href=t.replace(e.instrumentSearchConfig.placeholderSymbol,$(this).data("symbol")).replace(e.instrumentSearchConfig.placeholderId,e.lastSearchTermWithResult)})},{init:init});