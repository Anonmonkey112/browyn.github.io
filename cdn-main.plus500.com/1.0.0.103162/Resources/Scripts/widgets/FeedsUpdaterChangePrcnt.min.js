var isStopped,timeout,PercentagePrecision;function initWidget(e,t,a,i,n){PercentagePrecision=e,isStopped=!1,window.clearTimeout(timeout),t.data("loaded")||(updateData(t.find(i.dataElement).data("json"),i),i.features.noUpdate||t.data("loaded","true")),i.features.noUpdate||(nextWidgetUpdate(a,i,n),i.tab&&setTabVisibility(t,i)),setTimeout(function(){isStopped=!0},6e5)}function setTabVisibility(e,t){$(t.tab).removeClass(),$(t.tab+'[data-tab-id="'+e.data("tab-id")+'"]').addClass("selected"),$(t.tabPanel+":visible").not(e).css("display","none"),e.show()}function isThresholdReached(e,t){return null!=e&&null!=t&&Math.abs(e)>=t}function getWidgetData(e,t){isStopped||$.ajax({type:"GET",contentType:"text/plain",url:t.feedUpdateUrl,data:jQuery.param({instrumentIds:e}),success:function(a){updateData(a,t),nextWidgetUpdate(e,t)},error:function(a,i,n){nextWidgetUpdate(e,t)}})}function nextWidgetUpdate(e,t,a){var i=5;void 0!==window.widgetUpdateRate&&(i=window.widgetUpdateRate),timeout=setTimeout(function(){getWidgetData(e,t),e=null,t=null},a?0:1e3*i)}function updateData(e,t,a){if(null!=e&&e.length>0)for(PercentagePrecision=PercentagePrecision||a,i=0;i<e.length;i++){var n=$(t.instrumentPrefix+e[i].InstrumentId);if(n.length){var s=n.data("precision");if(t.features.buy){var l=parseFloat(n.find(t.buyPrice).html()),d=t.features.avarage?((e[i].BuyPrice+e[i].SellPrice)/2).toFixed(s):e[i].BuyPrice.toFixed(s);n.find(t.buyPrice).html(d),l>d?n.children(".buy, .sell").addClass(t.priceDownClass):l<d?n.children(".buy, .sell").addClass(t.priceUpClass):n.children(".buy, .sell").removeClass(t.priceUpClass+" "+t.priceDownClass)}if(t.features.sell){parseFloat(n.find(t.sellPrice).html());var r=e[i].SellPrice.toFixed(s);n.find(t.sellPrice).html(r)}if(t.features.change&&null!==e[i].ChangePercent){var o=e[i].ChangePercent.toFixed(PercentagePrecision),c=n.data("threshold"),u=isThresholdReached(e[i].ChangePercent,c),h=(parseFloat(n.find(t.changeLabel).html().split("%")[0]),n.find(t.changeLabel));u?n.addClass("highlight-threshold"):n.removeClass("highlight-threshold"),null!==h&&h.html(o+"%"),o<0?n.children(".rate-change").addClass(t.precentDownClass):o>0?n.children(".rate-change").addClass(t.precentUpClass):n.children(".rate-change").removeClass(t.precentUpClass+" "+t.precentDownClass)}}}}